AmCharts.AmFunnelChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(e){this.type="funnel",AmCharts.AmFunnelChart.base.construct.call(this,e),this.cname="AmFunnelChart",this.startX=this.startY=0,this.baseWidth="100%",this.neckHeight=this.neckWidth=0,this.rotate=!1,this.valueRepresents="height",this.pullDistance=30,this.labelPosition="center",this.labelText="[[title]]: [[value]]",this.balloonText="[[title]]: [[value]]\n[[description]]",AmCharts.applyTheme(this,e,this.cname)},drawChart:function(){AmCharts.AmFunnelChart.base.drawChart.call(this);var e=this.chartData;if(AmCharts.ifArray(e))if(0<this.realWidth&&0<this.realHeight){var t=this.container,n=this.startDuration,r=this.rotate,i=this.updateWidth();this.realWidth=i;var s=this.updateHeight();this.realHeight=s;var o=AmCharts.toCoordinate,u=o(this.marginLeft,i),a=o(this.marginRight,i),f=o(this.marginTop,s)+this.getTitleHeight(),o=o(this.marginBottom,s),a=i-u-a,l=AmCharts.toCoordinate(this.baseWidth,a),c=AmCharts.toCoordinate(this.neckWidth,a),h=s-o-f,p=AmCharts.toCoordinate(this.neckHeight,h),d=f+h-p;r&&(f=s-o,d=f-h+p),this.firstSliceY=f,AmCharts.VML&&(this.startAlpha=1);for(var v=a/2+u,m=(h-p)/((l-c)/2),g=l/2,l=(h-p)*(l+c)/2+c*p,y=f,b=0,p=0;p<e.length;p++){var w=e[p],E;if(!0!==w.hidden){var S=[],x=[],T;if("height"==this.valueRepresents)T=h*w.percents/100;else{var N=-l*w.percents/100/2,C=g;E=-1/(2*m),T=Math.pow(C,2)-4*E*N,0>T&&(T=0),T=(Math.sqrt(T)-C)/(2*E);if(!r&&f>=d||r&&f<=d)T=2*-N/c;else if(!r&&f+T>d||r&&f-T<d)E=r?Math.round(T+(f-T-d)):Math.round(T-(f+T-d)),T=E/m,T=E+2*(-N-(C-T/2)*E)/c}N=g-T/m,C=!1,!r&&f+T>d||r&&f-T<d?(N=c/2,S.push(v-g,v+g,v+N,v+N,v-N,v-N),r?(E=T+(f-T-d),f<d&&(E=0),x.push(f,f,f-E,f-T,f-T,f-E,f)):(E=T-(f+T-d),f>d&&(E=0),x.push(f,f,f+E,f+T,f+T,f+E,f)),C=!0):(S.push(v-g,v+g,v+N,v-N),r?x.push(f,f,f-T,f-T):x.push(f,f,f+T,f+T)),t.set(),E=t.set(),S=AmCharts.polygon(t,S,x,w.color,w.alpha,this.outlineThickness,this.outlineColor,this.outlineAlpha),E.push(S),this.graphsSet.push(E),w.wedge=E,w.index=p;if(x=this.gradientRatio){var k=[],L;for(L=0;L<x.length;L++)k.push(AmCharts.adjustLuminosity(w.color,x[L]));0<k.length&&S.gradient("linearGradient",k),w.pattern&&S.pattern(w.pattern)}0<n&&(this.chartCreated||E.setAttr("opacity",this.startAlpha)),this.addEventListeners(E,w),w.ty0=f-T/2,this.labelsEnabled&&this.labelText&&w.percents>=this.hideLabelsPercent&&(x=this.formatString(this.labelText,w),(S=this.labelFunction)&&(x=S(w,x)),k=w.labelColor,k||(k=this.color),S=this.labelPosition,L="left","center"==S&&(L="middle"),"left"==S&&(L="right"),x=AmCharts.wrappedText(t,x,k,this.fontFamily,this.fontSize,L,!1,this.maxLabelWidth),x.node.style.pointerEvents="none",E.push(x),k=v,r?(L=f-T/2,w.ty0=L):(L=f+T/2,w.ty0=L,L<y+b+5&&(L=y+b+5),L>s-o&&(L=s-o)),"right"==S&&(k=a+10+u,w.tx0=v+(g-T/2/m),C&&(w.tx0=v+N)),"left"==S&&(w.tx0=v-(g-T/2/m),C&&(w.tx0=v-N),k=u),w.label=x,w.labelX=k,w.labelY=L,w.labelHeight=x.getBBox().height,x.translate(k,L),g=x.getBBox(),y=AmCharts.rect(t,g.width+5,g.height+5,"#ffffff",.005),y.translate(k+g.x,L+g.y),E.push(y),w.hitRect=y,b=x.getBBox().height,y=L),(0===w.alpha||0<n&&!this.chartCreated)&&E.hide(),f=r?f-T:f+T,g=N,w.startX=AmCharts.toCoordinate(this.startX,i),w.startY=AmCharts.toCoordinate(this.startY,s),w.pullX=AmCharts.toCoordinate(this.pullDistance,i),w.pullY=0,w.balloonX=v,w.balloonY=w.ty0}}this.arrangeLabels(),this.initialStart(),(e=this.legend)&&e.invalidateSize()}else this.cleanChart();this.dispDUpd(),this.chartCreated=!0},arrangeLabels:function(){var e=this.rotate,t;t=e?0:this.realHeight;for(var n=0,r=this.chartData,i=r.length,s,o=0;o<i;o++){s=r[i-o-1];var u=s.label,a=s.labelY,f=s.labelX,l=s.labelHeight,c=a;e?t+n+5>a&&(c=t+n+5):a+l+5>t&&(c=t-5-l),t=c,n=l;if(u){u.translate(f,c);var h=u.getBBox()}s.hitRect.translate(f+h.x,c+h.y),s.labelY=c,s.tx=f,s.ty=c,s.tx2=f}"center"!=this.labelPosition&&this.drawTicks()}});