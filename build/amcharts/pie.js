AmCharts.AmPieChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(e){this.type="pie",AmCharts.AmPieChart.base.construct.call(this,e),this.cname="AmPieChart",this.pieBrightnessStep=30,this.minRadius=10,this.depth3D=0,this.startAngle=90,this.angle=this.innerRadius=0,this.startRadius="500%",this.pullOutRadius="20%",this.labelRadius=20,this.labelText="[[title]]: [[percents]]%",this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]",this.previousScale=1,AmCharts.applyTheme(this,e,this.cname)},drawChart:function(){AmCharts.AmPieChart.base.drawChart.call(this);var e=this.chartData;if(AmCharts.ifArray(e)){if(0<this.realWidth&&0<this.realHeight){AmCharts.VML&&(this.startAlpha=1);var t=this.startDuration,n=this.container,r=this.updateWidth();this.realWidth=r;var i=this.updateHeight();this.realHeight=i;var s=AmCharts.toCoordinate,o=s(this.marginLeft,r),u=s(this.marginRight,r),a=s(this.marginTop,i)+this.getTitleHeight(),f=s(this.marginBottom,i),l,c,h,p=AmCharts.toNumber(this.labelRadius),d=this.measureMaxLabel();d>this.maxLabelWidth&&(d=this.maxLabelWidth),this.labelText&&this.labelsEnabled||(p=d=0),l=void 0===this.pieX?(r-o-u)/2+o:s(this.pieX,this.realWidth),c=void 0===this.pieY?(i-a-f)/2+a:s(this.pieY,i),h=s(this.radius,r,i),h||(r=0<=p?r-o-u-2*d:r-o-u,i=i-a-f,h=Math.min(r,i),i<r&&(h/=1-this.angle/90,h>r&&(h=r)),i=AmCharts.toCoordinate(this.pullOutRadius,h),h=(0<=p?h-1.8*(p+i):h-1.8*i)/2),h<this.minRadius&&(h=this.minRadius),i=s(this.pullOutRadius,h),a=AmCharts.toCoordinate(this.startRadius,h),s=s(this.innerRadius,h),s>=h&&(s=h-1),f=AmCharts.fitToBounds(this.startAngle,0,360),0<this.depth3D&&(f=270<=f?270:90),f-=90,r=h-h*this.angle/90;for(o=0;o<e.length;o++)if(u=e[o],!0!==u.hidden&&0<u.percents){var v=360*u.percents/100,d=Math.sin((f+v/2)/180*Math.PI),m=-Math.cos((f+v/2)/180*Math.PI)*(r/h),g=this.outlineColor;g||(g=u.color);var y=this.alpha;isNaN(u.alpha)||(y=u.alpha),g={fill:u.color,stroke:g,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha,"fill-opacity":y},u.url&&(g.cursor="pointer"),g=AmCharts.wedge(n,l,c,f,v,h,r,s,this.depth3D,g,this.gradientRatio,u.pattern),this.addEventListeners(g,u),u.startAngle=f,e[o].wedge=g,0<t&&(this.chartCreated||g.setAttr("opacity",this.startAlpha)),u.ix=d,u.iy=m,u.wedge=g,u.index=o;if(this.labelsEnabled&&this.labelText&&u.percents>=this.hideLabelsPercent){var b=f+v/2;360<b&&(b-=360);var w=p;isNaN(u.labelRadius)||(w=u.labelRadius);var v=l+d*(h+w),y=c+m*(h+w),E,S=0;if(0<=w){var x;90>=b&&0<=b?(x=0,E="start",S=8):90<=b&&180>b?(x=1,E="start",S=8):180<=b&&270>b?(x=2,E="end",S=-8):270<=b&&360>b&&(x=3,E="end",S=-8),u.labelQuarter=x}else E="middle";var b=this.formatString(this.labelText,u),T=this.labelFunction;T&&(b=T(u,b)),T=u.labelColor,T||(T=this.color),b=AmCharts.wrappedText(n,b,T,this.fontFamily,this.fontSize,E,!1,this.maxLabelWidth),b.translate(v+1.5*S,y),b.node.style.pointerEvents="none",u.tx=v+1.5*S,u.ty=y,0<=w?(w=b.getBBox(),T=AmCharts.rect(n,w.width+5,w.height+5,"#FFFFFF",.005),T.translate(v+1.5*S+w.x,y+w.y),u.hitRect=T,g.push(b),g.push(T)):this.freeLabelsSet.push(b),u.label=b,u.tx=v,u.tx2=v+S,u.tx0=l+d*h,u.ty0=c+m*h}v=s+(h-s)/2,u.pulled&&(v+=this.pullOutRadiusReal),u.balloonX=d*v+l,u.balloonY=m*v+c,u.startX=Math.round(d*a),u.startY=Math.round(m*a),u.pullX=Math.round(d*i),u.pullY=Math.round(m*i),this.graphsSet.push(g),(0===u.alpha||0<t&&!this.chartCreated)&&g.hide(),f+=360*u.percents/100}0<p&&!this.labelRadiusField&&this.arrangeLabels(),this.pieXReal=l,this.pieYReal=c,this.radiusReal=h,this.innerRadiusReal=s,0<p&&this.drawTicks(),this.initialStart(),this.setDepths()}(e=this.legend)&&e.invalidateSize()}else this.cleanChart();this.dispDUpd(),this.chartCreated=!0},setDepths:function(){var e=this.chartData,t;for(t=0;t<e.length;t++){var n=e[t],r=n.wedge,n=n.startAngle;0<=n&&180>n?r.toFront():180<=n&&r.toBack()}},arrangeLabels:function(){var e=this.chartData,t=e.length,n,r;for(r=t-1;0<=r;r--)n=e[r],0!==n.labelQuarter||n.hidden||this.checkOverlapping(r,n,0,!0,0);for(r=0;r<t;r++)n=e[r],1!=n.labelQuarter||n.hidden||this.checkOverlapping(r,n,1,!1,0);for(r=t-1;0<=r;r--)n=e[r],2!=n.labelQuarter||n.hidden||this.checkOverlapping(r,n,2,!0,0);for(r=0;r<t;r++)n=e[r],3!=n.labelQuarter||n.hidden||this.checkOverlapping(r,n,3,!1,0)},checkOverlapping:function(e,t,n,r,i){var s,o,u=this.chartData,a=u.length,f=t.label;if(f){if(!0===r)for(o=e+1;o<a;o++)u[o].labelQuarter==n&&(s=this.checkOverlappingReal(t,u[o],n))&&(o=a);else for(o=e-1;0<=o;o--)u[o].labelQuarter==n&&(s=this.checkOverlappingReal(t,u[o],n))&&(o=0);!0===s&&100>i&&(s=t.ty+3*t.iy,t.ty=s,f.translate(t.tx2,s),t.hitRect&&(f=f.getBBox(),t.hitRect.translate(t.tx2+f.x,s+f.y)),this.checkOverlapping(e,t,n,r,i+1))}},checkOverlappingReal:function(e,t,n){var r=!1,i=e.label,s=t.label;return e.labelQuarter!=n||e.hidden||t.hidden||!s||(i=i.getBBox(),n={},n.width=i.width,n.height=i.height,n.y=e.ty,n.x=e.tx,e=s.getBBox(),s={},s.width=e.width,s.height=e.height,s.y=t.ty,s.x=t.tx,AmCharts.hitTest(n,s)&&(r=!0)),r}});