AmCharts.AmXYChart=AmCharts.Class({inherits:AmCharts.AmRectangularChart,construct:function(e){this.type="xy",AmCharts.AmXYChart.base.construct.call(this,e),this.cname="AmXYChart",this.theme=e,this.createEvents("zoomed"),this.maxZoomFactor=20,AmCharts.applyTheme(this,e,this.cname)},initChart:function(){AmCharts.AmXYChart.base.initChart.call(this),this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0),this.updateScrollbar=!0,this.drawChart(),this.autoMargins&&!this.marginsUpdated&&(this.marginsUpdated=!0,this.measureMargins());var e=this.marginLeftReal,t=this.marginTopReal,n=this.plotAreaWidth,r=this.plotAreaHeight;this.graphsSet.clipRect(e,t,n,r),this.bulletSet.clipRect(e,t,n,r),this.trendLinesSet.clipRect(e,t,n,r)},prepareForExport:function(){var e=this.bulletSet;e.clipPath&&this.container.remove(e.clipPath)},createValueAxes:function(){var e=[],t=[];this.xAxes=e,this.yAxes=t;var n=this.valueAxes,r,i;for(i=0;i<n.length;i++){r=n[i];var s=r.position;if("top"==s||"bottom"==s)r.rotate=!0;r.setOrientation(r.rotate),s=r.orientation,"V"==s&&t.push(r),"H"==s&&e.push(r)}0===t.length&&(r=new AmCharts.ValueAxis(this.theme),r.rotate=!1,r.setOrientation(!1),n.push(r),t.push(r)),0===e.length&&(r=new AmCharts.ValueAxis(this.theme),r.rotate=!0,r.setOrientation(!0),n.push(r),e.push(r));for(i=0;i<n.length;i++)this.processValueAxis(n[i],i);e=this.graphs;for(i=0;i<e.length;i++)this.processGraph(e[i],i)},drawChart:function(){AmCharts.AmXYChart.base.drawChart.call(this),AmCharts.ifArray(this.chartData)?(this.chartScrollbar&&this.updateScrollbars(),this.zoomChart()):this.cleanChart();if(this.hideXScrollbar){var e=this.scrollbarH;e&&(this.removeListener(e,"zoomed",this.handleHSBZoom),e.destroy()),this.scrollbarH=null}if(this.hideYScrollbar){if(e=this.scrollbarV)this.removeListener(e,"zoomed",this.handleVSBZoom),e.destroy();this.scrollbarV=null}if(!this.autoMargins||this.marginsUpdated)this.dispDUpd(),this.chartCreated=!0,this.zoomScrollbars()},cleanChart:function(){AmCharts.callMethod("destroy",[this.valueAxes,this.graphs,this.scrollbarV,this.scrollbarH,this.chartCursor])},zoomChart:function(){this.toggleZoomOutButton(),this.zoomObjects(this.valueAxes),this.zoomObjects(this.graphs),this.zoomTrendLines(),this.dispatchAxisZoom()},toggleZoomOutButton:function(){1==this.heightMultiplier&&1==this.widthMultiplier?this.showZB(!1):this.showZB(!0)},dispatchAxisZoom:function(){var e=this.valueAxes,t;for(t=0;t<e.length;t++){var n=e[t];if(!isNaN(n.min)&&!isNaN(n.max)){var r,i;"V"==n.orientation?(r=n.coordinateToValue(-this.verticalPosition),i=n.coordinateToValue(-this.verticalPosition+this.plotAreaHeight)):(r=n.coordinateToValue(-this.horizontalPosition),i=n.coordinateToValue(-this.horizontalPosition+this.plotAreaWidth));if(!isNaN(r)&&!isNaN(i)){if(r>i){var s=i;i=r,r=s}n.dispatchZoomEvent(r,i)}}}},zoomObjects:function(e){var t=e.length,n;for(n=0;n<t;n++){var r=e[n];this.updateObjectSize(r),r.zoom(0,this.chartData.length-1)}},updateData:function(){this.parseData();var e=this.chartData,t=e.length-1,n=this.graphs,r=this.dataProvider,i=-Infinity,s=Infinity,o,u;for(o=0;o<n.length;o++)if(u=n[o],u.data=e,u.zoom(0,t),u=u.valueField){var a;for(a=0;a<r.length;a++){var f=Number(r[a][u]);f>i&&(i=f),f<s&&(s=f)}}for(o=0;o<n.length;o++)u=n[o],u.maxValue=i,u.minValue=s;if(e=this.chartCursor)e.updateData(),e.type="crosshair",e.valueBalloonsEnabled=!1},zoomOut:function(){this.verticalPosition=this.horizontalPosition=0,this.heightMultiplier=this.widthMultiplier=1,this.zoomChart(),this.zoomScrollbars()},processValueAxis:function(e){e.chart=this,e.minMaxField="H"==e.orientation?"x":"y",e.minTemp=NaN,e.maxTemp=NaN,this.listenTo(e,"axisSelfZoomed",this.handleAxisSelfZoom)},processGraph:function(e){AmCharts.isString(e.xAxis)&&(e.xAxis=this.getValueAxisById(e.xAxis)),AmCharts.isString(e.yAxis)&&(e.yAxis=this.getValueAxisById(e.yAxis)),e.xAxis||(e.xAxis=this.xAxes[0]),e.yAxis||(e.yAxis=this.yAxes[0]),e.valueAxis=e.yAxis},parseData:function(){AmCharts.AmXYChart.base.parseData.call(this),this.chartData=[];var e=this.dataProvider,t=this.valueAxes,n=this.graphs,r;if(e)for(r=0;r<e.length;r++){var i={axes:{},x:{},y:{}},s=e[r],o;for(o=0;o<t.length;o++){var u=t[o].id;i.axes[u]={},i.axes[u].graphs={};var a;for(a=0;a<n.length;a++){var f=n[a],l=f.id;if(f.xAxis.id==u||f.yAxis.id==u){var c={};c.serialDataItem=i,c.index=r;var h={},p=Number(s[f.valueField]);isNaN(p)||(h.value=p),p=Number(s[f.xField]),isNaN(p)||(h.x=p),p=Number(s[f.yField]),isNaN(p)||(h.y=p),p=Number(s[f.errorField]),isNaN(p)||(h.error=p),c.values=h,this.processFields(f,c,s),c.serialDataItem=i,c.graph=f,i.axes[u].graphs[l]=c}}}this.chartData[r]=i}},formatString:function(e,t,n){var r=t.graph.numberFormatter;return r||(r=this.nf),e=AmCharts.formatValue(e,t.values,["value","x","y"],r),-1!=e.indexOf("[[")&&(e=AmCharts.formatDataContextValue(e,t.dataContext)),e=AmCharts.AmXYChart.base.formatString.call(this,e,t,n)},addChartScrollbar:function(e){AmCharts.callMethod("destroy",[this.chartScrollbar,this.scrollbarH,this.scrollbarV]);if(e){this.chartScrollbar=e,this.scrollbarHeight=e.scrollbarHeight;var t="backgroundColor backgroundAlpha selectedBackgroundColor selectedBackgroundAlpha scrollDuration resizeEnabled hideResizeGrips scrollbarHeight updateOnReleaseOnly".split(" ");if(!this.hideYScrollbar){var n=new AmCharts.SimpleChartScrollbar(this.theme);n.skipEvent=!0,n.chart=this,this.listenTo(n,"zoomed",this.handleVSBZoom),AmCharts.copyProperties(e,n,t),n.rotate=!0,this.scrollbarV=n}this.hideXScrollbar||(n=new AmCharts.SimpleChartScrollbar(this.theme),n.skipEvent=!0,n.chart=this,this.listenTo(n,"zoomed",this.handleHSBZoom),AmCharts.copyProperties(e,n,t),n.rotate=!1,this.scrollbarH=n)}},updateTrendLines:function(){var e=this.trendLines,t;for(t=0;t<e.length;t++){var n=e[t],n=AmCharts.processObject(n,AmCharts.TrendLine,this.theme);e[t]=n,n.chart=this;var r=n.valueAxis;AmCharts.isString(r)&&(n.valueAxis=this.getValueAxisById(r)),r=n.valueAxisX,AmCharts.isString(r)&&(n.valueAxisX=this.getValueAxisById(r)),n.valueAxis||(n.valueAxis=this.yAxes[0]),n.valueAxisX||(n.valueAxisX=this.xAxes[0])}},updateMargins:function(){AmCharts.AmXYChart.base.updateMargins.call(this);var e=this.scrollbarV;e&&(this.getScrollbarPosition(e,!0,this.yAxes[0].position),this.adjustMargins(e,!0));if(e=this.scrollbarH)this.getScrollbarPosition(e,!1,this.xAxes[0].position),this.adjustMargins(e,!1)},updateScrollbars:function(){AmCharts.AmXYChart.base.updateScrollbars.call(this);var e=this.scrollbarV;e&&(this.updateChartScrollbar(e,!0),e.draw());if(e=this.scrollbarH)this.updateChartScrollbar(e,!1),e.draw()},zoomScrollbars:function(){var e=this.scrollbarH;e&&e.relativeZoom(this.widthMultiplier,-this.horizontalPosition/this.widthMultiplier),(e=this.scrollbarV)&&e.relativeZoom(this.heightMultiplier,-this.verticalPosition/this.heightMultiplier)},fitMultiplier:function(e){return e>this.maxZoomFactor&&(e=this.maxZoomFactor),e},handleHSBZoom:function(e){var t=this.fitMultiplier(e.multiplier);e=-e.position*t;var n=-(this.plotAreaWidth*t-this.plotAreaWidth);e<n&&(e=n),this.widthMultiplier=t,this.horizontalPosition=e,this.zoomChart()},handleVSBZoom:function(e){var t=this.fitMultiplier(e.multiplier);e=-e.position*t;var n=-(this.plotAreaHeight*t-this.plotAreaHeight);e<n&&(e=n),this.heightMultiplier=t,this.verticalPosition=e,this.zoomChart()},handleAxisSelfZoom:function(e){if("H"==e.valueAxis.orientation){var t=this.fitMultiplier(e.multiplier);e=-e.position*t;var n=-(this.plotAreaWidth*t-this.plotAreaWidth);e<n&&(e=n),this.horizontalPosition=e,this.widthMultiplier=t}else t=this.fitMultiplier(e.multiplier),e=-e.position*t,n=-(this.plotAreaHeight*t-this.plotAreaHeight),e<n&&(e=n),this.verticalPosition=e,this.heightMultiplier=t;this.zoomChart(),t=this.graphs;for(e=0;e<t.length;e++)t[e].setAnimationPlayed();this.zoomScrollbars()},handleCursorZoom:function(e){var t=this.widthMultiplier*this.plotAreaWidth/e.selectionWidth,n=this.heightMultiplier*this.plotAreaHeight/e.selectionHeight,t=this.fitMultiplier(t),n=this.fitMultiplier(n);this.horizontalPosition=(this.horizontalPosition-e.selectionX)*t/this.widthMultiplier,this.verticalPosition=(this.verticalPosition-e.selectionY)*n/this.heightMultiplier,this.widthMultiplier=t,this.heightMultiplier=n,this.zoomChart(),this.zoomScrollbars()},removeChartScrollbar:function(){AmCharts.callMethod("destroy",[this.scrollbarH,this.scrollbarV]),this.scrollbarV=this.scrollbarH=null},handleReleaseOutside:function(e){AmCharts.AmXYChart.base.handleReleaseOutside.call(this,e),AmCharts.callMethod("handleReleaseOutside",[this.scrollbarH,this.scrollbarV])}});