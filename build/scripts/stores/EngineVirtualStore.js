define(["game-logic/engine","lib/events","dispatcher/AppDispatcher","constants/AppConstants","lib/clib"],function(e,t,n,r,i){var s="change",o=_.extend({},t,{emitChange:function(){this.trigger(s)},addChangeListener:function(e){this.on(s,e)},removeChangeListener:function(e){this.off(s,e)},_placeBet:function(t,n){e.bet(t,n)},_cancelBet:function(){e.cancelBet()},_cashOut:function(){e.cashOut()},_sayChat:function(t){e.say(t)},getState:function(){function t(){if(!e.username)return!1;if(e.nextBetAmount)return!0;for(var t=0;t<e.joined.length;++t)if(e.joined[t]==e.username)return!0;return!1}function n(){return e.username?e.playerInfo[e.username]:null}function s(){if(e.gameState!=="IN_PROGRESS")return null;var t;Date.now()-e.lastGameTick<r.Engine.STOP_PREDICTING_LAPSE?t=Date.now()-e.startTime:t=e.lastGameTick-e.startTime+r.Engine.STOP_PREDICTING_LAPSE;var n=i.growthFunc(t);return console.assert(isFinite(n)),n}return{gameState:e.gameState,startTime:e.startTime,currentTime:e.currentTime,playerInfo:e.playerInfo,tableHistory:e.tableHistory,username:e.username,isConnected:e.isConnected,isBetting:t(),hash:e.hash,currentPlay:n(),gamePayout:s(),nextBetAmount:e.nextBetAmount,nextAutoCashout:e.nextAutoCashout,joined:e.joined,chat:e.chat,balanceSatoshis:e.balanceSatoshis}}});return e.on("all",function(e){o.emitChange()}),n.register(function(e){var t=e.action;switch(t.actionType){case r.ActionTypes.PLACE_BET:o._placeBet(t.bet,t.cashOut);break;case r.ActionTypes.CANCEL_BET:o._cancelBet();break;case r.ActionTypes.CASH_OUT:o._cashOut();break;case r.ActionTypes.SAY_CHAT:o._sayChat(t.msg)}return!0}),o});