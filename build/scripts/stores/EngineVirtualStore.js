define(["game-logic/engine","lib/events","dispatcher/AppDispatcher","constants/AppConstants","lib/clib"],function(e,t,n,r,i){var s="change",o=_.extend({},t,{emitChange:function(){this.trigger(s)},addChangeListener:function(e){this.on(s,e)},removeChangeListener:function(e){this.off(s,e)},_placeBet:function(t,n){e.bet(t,n)},_cancelBet:function(){e.cancelBet()},_cashOut:function(){e.cashOut()},_sayChat:function(t){e.say(t)},getState:function(){function t(){if(!e.username)return!1;if(e.nextBetAmount)return!0;for(var t=0;t<e.joined.length;++t)if(e.joined[t]==e.username)return!0;return!1}var n;e.username?n=e.playerInfo[e.username]:n=null;var r=n&&n.bet&&!n.stopped_at;return{gameState:e.gameState,startTime:e.startTime,currentTime:e.currentTime,playerInfo:e.playerInfo,tableHistory:e.tableHistory,username:e.username,isConnected:e.isConnected,lastHash:e.lastHash,nextBetAmount:e.nextBetAmount,nextAutoCashout:e.nextAutoCashout,joined:e.joined,chat:e.chat,balanceSatoshis:e.balanceSatoshis,gameId:e.gameId,lag:e.lag,lastGameTick:e.lastGameTick,maxWin:e.maxWin,isBetting:t(),currentPlay:n,currentlyPlaying:r}}});return e.on("all",function(e){o.emitChange()}),n.register(function(e){var t=e.action;switch(t.actionType){case r.ActionTypes.PLACE_BET:o._placeBet(t.bet,t.cashOut);break;case r.ActionTypes.CANCEL_BET:o._cancelBet();break;case r.ActionTypes.CASH_OUT:o._cashOut();break;case r.ActionTypes.SAY_CHAT:o._sayChat(t.msg)}return!0}),o});