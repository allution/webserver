define(["lib/react","lib/clib","components/Graph","game-logic/engine"],function(e,t,n,r){function s(){return{engine:r}}var i=e.DOM;return e.createClass({displayName:"Chart",getInitialState:function(){return s()},_onChange:function(){this.isMounted()&&this.setState(s())},componentWillMount:function(){var e;window.onresize=function(){window.innerWidth>767?window.innerWidth<1e3?e=Math.floor(window.innerWidth*.58):e=600:e=window.innerWidth*.9,self.graph=new n(e,300)},window.innerWidth>767?window.innerWidth<1e3?e=Math.floor(window.innerWidth*.58):e=600:e=window.innerWidth*.9,this.graph=new n(e,300)},componentWillUnmount:function(){r.off({game_started:this._onChange,game_crash:this._onChange,game_starting:this._onChange,lag_change:this._onChange}),this.mounted=!1},componentDidMount:function(){r.on({game_started:this._onChange,game_crash:this._onChange,game_starting:this._onChange,lag_change:this._onChange}),this.mounted=!0,this.animRequest=window.requestAnimationFrame(this._draw)},_draw:function(){if(this.mounted){var e=this.refs.canvas.getDOMNode();if(!e.getContext){console.log("No canvas");return}var t=e.getContext("2d");this.graph.setData(t,e,this.state.engine),this.graph.calculatePlotValues(),this.graph.clean(),this.graph.drawGraph(),this.graph.drawAxes(),this.graph.drawGameData(),this.animRequest=window.requestAnimationFrame(this._draw)}},render:function(){return i.div({className:"chart",style:{position:"relative"}},i.div({style:{position:"absolute",bottom:"27px",right:"30px",fontSize:"55%"}},"Max profit: ",(this.state.engine.maxWin/1e8).toFixed(4)," BTC"),i.canvas({width:this.graph.canvasWidth,height:this.graph.canvasHeight,ref:"canvas"}))}})});