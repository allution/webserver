define(["lib/react","lib/lodash","lib/clib","stores/EngineVirtualStore"],function(e,t,n,r){function s(){return{engine:r.getState()}}function o(e){if(Object.getOwnPropertyNames(e.playerInfo).length<=0)return{playingLost:0,cashedWon:0,cashedWonAfter:0,me:0};var n=0,r=0,i=0,s=e.currentPlay?e.currentPlay.bet:0,o=e.currentPlay&&e.currentPlay.stopped_at?e.currentPlay.stopped_at:0;t.forEach(e.playerInfo,function(t,s){s!==e.username&&(t.stopped_at?t.stopped_at>o?i+=t.bet:r+=t.bet:n+=t.bet)});var u=n+r+i+s,a={playingLost:n/u*100,cashedWon:r/u*100,cashedWonAfter:i/u*100,me:s/u*100};return a}var i=e.DOM;return e.createClass({displayName:"BetBar",getInitialState:function(){return s()},componentDidMount:function(){r.addChangeListener(this._onChange)},componentWillUnmount:function(){r.removeChangeListener(this._onChange)},_onChange:function(){this.isMounted()&&this.setState(s())},render:function(){var e=this;if(this.state.engine.gameState==="STARTING")return i.div({className:"bet-bar-starting"});var t=o(this.state.engine),n,r,s;return this.state.engine.gameState==="ENDED"?(n="bet-bar-lost",r="bet-bar-won",s=this.state.engine.currentlyPlaying?"bet-bar-me-lost":"bet-bar-me-won"):(n="bet-bar-playing",r="bet-bar-cashed",s=this.state.engine.currentlyPlaying?"bet-bar-me-playing":"bet-bar-me-cashed"),i.div({className:"bet-bar-container"},i.div({className:r,style:{width:t.cashedWon+"%"}}),i.div({className:s,style:{width:t.me+"%"}}),i.div({className:r,style:{width:t.cashedWonAfter+"%"}}),i.div({className:n,style:{width:t.playingLost+"%"}}))}})});