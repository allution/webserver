define(["lib/react","lib/lodash","lib/clib","game-logic/engine"],function(e,t,n,r){function s(){return{engine:r}}function o(e){if(Object.getOwnPropertyNames(e.playerInfo).length<=0)return{playingLost:0,cashedWon:0,cashedWonAfter:0,me:0};var n=0,r=0,i=0,s=e.currentPlay(),o=s?s.bet:0,u=s&&s.stopped_at?s.stopped_at:0;t.forEach(e.playerInfo,function(t,s){s!==e.username&&(t.stopped_at?t.stopped_at>u?i+=t.bet:r+=t.bet:n+=t.bet)});var a=n+r+i+o;return{playingLost:n/a*100,cashedWon:r/a*100,cashedWonAfter:i/a*100,me:o/a*100}}var i=e.DOM;return e.createClass({displayName:"BetBar",getInitialState:function(){return s()},componentDidMount:function(){r.on({game_started:this._onChange,game_crash:this._onChange,game_starting:this._onChange,player_bet:this._onChange,cashed_out:this._onChange})},componentWillUnmount:function(){r.off({game_started:this._onChange,game_crash:this._onChange,game_starting:this._onChange,player_bet:this._onChange,cashed_out:this._onChange})},_onChange:function(){this.isMounted()&&this.setState(s())},render:function(){if(this.state.engine.gameState==="STARTING")return i.div({className:"bet-bar-starting"});var e=o(this.state.engine),t,n,r;return this.state.engine.gameState==="ENDED"?(t="bet-bar-lost",n="bet-bar-won",r=this.state.engine.currentlyPlaying()?"bet-bar-me-lost":"bet-bar-me-won"):(t="bet-bar-playing",n="bet-bar-cashed",r=this.state.engine.currentlyPlaying()?"bet-bar-me-playing":"bet-bar-me-cashed"),i.div({className:"bet-bar-container"},i.div({className:n,style:{width:e.cashedWon+"%"}}),i.div({className:r,style:{width:e.me+"%"}}),i.div({className:n,style:{width:e.cashedWonAfter+"%"}}),i.div({className:t,style:{width:e.playingLost+"%"}}))}})});