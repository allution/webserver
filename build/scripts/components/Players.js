define(["lib/react","lib/clib","lib/lodash","stores/EngineVirtualStore"],function(e,t,n,r){function s(e,t){return(t-100)*e/100}function o(){return{engine:r.getState()}}var i=e.DOM;return e.createClass({displayName:"usersPlaying",getInitialState:function(){return o()},componentDidMount:function(){r.addChangeListener(this._onChange)},componentWillUnmount:function(){r.removeChangeListener(this._onChange)},_onChange:function(){this.isMounted()&&this.setState(o())},render:function(){var e=this,r=[],o=[],u,a,f,l,c;e.state.engine.gameState==="STARTING"?o=e.state.engine.joined.map(function(t){var n;return t===e.state.engine.username&&(n=e.state.engine.nextBetAmount),{username:t,info:{bet:n}}}):(n.forEach(e.state.engine.playerInfo,function(e,t){e.stopped_at?r.push({username:t,info:e}):o.push({username:t,info:e})}),r.sort(function(e,t){var n=t.info.stopped_at-e.info.stopped_at;return n!==0?n:e.username<t.username?1:-1}),o.sort(function(e,t){var n=t.info.bet-e.info.bet;return n!==0?n:e.username<t.username?1:-1}));if(e.state.engine.gameState==="IN_PROGRESS"||e.state.engine.gameState==="STARTING"){a=[];for(var h=0,p=o.length;h<p;h++)a.push(i.tr({className:"user-playing",key:"user"+h},i.td(null,i.a({href:"/user/"+o[h].username,target:"_blank"},o[h].username)),i.td(null,"-"),i.td(null,o[h].info.bet?t.formatSatoshis(o[h].info.bet,0):"?"),i.td(null,"-"),i.td(null,"-")));u=[];for(var h=0,p=r.length;h<p;h++){var d=r[h],v=d.info.bet,m=s(v,d.info.stopped_at);u.push(i.tr({className:"user-cashed",key:"user"+h},i.td(null,i.a({href:"/user/"+d.username,target:"_blank"},d.username)),i.td(null,d.info.stopped_at/100+"x"),i.td(null,t.formatSatoshis(v,0)),i.td(null,"-"),i.td(null,t.formatSatoshis(m))))}f=i.tbody({className:""},a,u),l="users-playing-container",c="users-playing"}else e.state.engine.gameState==="ENDED"&&(a=o.map(function(e,n){var r=e.info.bet,s=e.info.bonus,o=-r;return s?(o=t.formatSatoshis(o+s),s=t.formatDecimals(s*100/r,2)+"%"):(o=t.formatSatoshis(o),s="0%"),i.tr({className:"user-lost",key:"user"+n},i.td(null,i.a({href:"/user/"+e.username,target:"_blank"},e.username)),i.td(null,"-"),i.td(null,t.formatSatoshis(e.info.bet,0)),i.td(null,s),i.td(null,o))}),u=r.map(function(e,n){var r=e.info.bet,s=e.info.bonus,o=e.info.stopped_at,u=r*(o-100)/100;return s?(u=t.formatSatoshis(u+s),s=t.formatDecimals(s*100/r,2)+"%"):(u=t.formatSatoshis(u),s="0%"),i.tr({className:"user-won",key:"user"+n},i.td(null,i.a({href:"/user/"+e.username,target:"_blank"},e.username)),i.td(null,o/100,"x"),i.td(null,t.formatSatoshis(r,0)),i.td(null,s),i.td(null,u))}),f=i.tbody({className:""},a,u),l="users-cashed-container",c="users-summary");return i.div({className:l},i.table({className:c},i.thead(null,i.tr(null,i.th(null,"User"),i.th(null,"@"),i.th(null,"Bet"),i.th(null,"Bonus"),i.th(null,"Profit"))),f))}})});